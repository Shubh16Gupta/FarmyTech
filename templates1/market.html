<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Prices - FarmyTech</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.css">
    <link rel="stylesheet" href="/assets/css/market.css">
    
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-leaf"></i>
                <h1>FarmyTech</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="index.html">Dashboard</a></li>
                    <li><a href="analytics.html">Analytics</a></li>
                    <li><a href="history.html">History</a></li>
                    <li><a href="market.html" class="active">Market</a></li>
                    <li><a href="support.html">Support</a></li>
                </ul>
            </nav>
            <div class="user-actions">
                <div class="user-welcome">
                    <span>Welcome, <span id="username">Farmer</span></span>
                    <button class="btn btn-sm" id="logoutBtn">Logout</button>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="page-header">
            <h2><i class="fas fa-chart-line"></i> Real-Time Crop Market</h2>
            <p>Track current prices, trends, and market data for your crops</p>
        </div>

        <div class="controls">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Search for crops...">
            </div>
            <div class="filter-group">
                <select class="filter-select" id="regionFilter">
                    <option value="all">All Regions</option>
                    <option value="north">North Region</option>
                    <option value="south">South Region</option>
                    <option value="east">East Region</option>
                    <option value="west">West Region</option>
                </select>
                <select class="filter-select" id="sortBy">
                    <option value="name">Sort by Name</option>
                    <option value="price">Sort by Price</option>
                    <option value="change">Sort by Change</option>
                </select>
            </div>
        </div>

        <div class="refresh-info">
            <i class="fas fa-sync-alt"></i> Data updates every <span id="countdown">60</span> seconds
        </div>

        <div class="market-grid" id="marketGrid">
            <div class="loading">
                <i class="fas fa-spinner"></i>
                <h3>Loading market data...</h3>
                <p>Fetching real-time crop prices</p>
            </div>
        </div>

        <div class="chart-container">
            <canvas id="marketChart"></canvas>
        </div>
    </div>

    <footer>
        <div class="container footer-content">
            <div class="footer-section">
                <h3>FarmyTech</h3>
                <p>AI-powered farming assistance for higher yields and sustainable practices.</p>
                <div class="social-icons">
                    <a href="#"><i class="fab fa-facebook"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-linkedin"></i></a>
                </div>
            </div>
            
            <div class="footer-section">
                <h3>Quick Links</h3>
                <p><a href="#">How It Works</a></p>
                <p><a href="#">Crop Database</a></p>
                <p><a href="#">Weather Forecast</a></p>
                <p><a href="#">Market Prices</a></p>
            </div>
            
            <div class="footer-section">
                <h3>Contact Us</h3>
                <p><i class="fas fa-envelope"></i> support@farmytech.com</p>
                <p><i class="fas fa-phone"></i> +1 (555) 123-4567</p>
                <p><i class="fas fa-map-marker-alt"></i> 123 Farm Lane, Agriculture City</p>
            </div>
        </div>
        
        <div class="copyright">
            <p>&copy; 2023 FarmyTech. All rights reserved.</p>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<script>
    // Crop data with initial values
    const cropData = [
        { id: 1, name: "Wheat", icon: "fas fa-bread-slice", price: 210.75, change: 0, unit: "per bushel", high: 215.20, low: 208.50, volume: 125000, region: "north" },
        { id: 2, name: "Corn", icon: "fas fa-seedling", price: 635.25, change: 0, unit: "per bushel", high: 642.00, low: 630.75, volume: 98000, region: "south" },
        { id: 3, name: "Soybeans", icon: "fas fa-leaf", price: 1420.50, change: 0, unit: "per bushel", high: 1435.00, low: 1412.75, volume: 76000, region: "north" },
        { id: 4, name: "Rice", icon: "fas fa-ring", price: 16.40, change: 0, unit: "per kg", high: 16.80, low: 16.20, volume: 215000, region: "east" },
        { id: 5, name: "Tomatoes", icon: "fas fa-apple-alt", price: 32.75, change: 0, unit: "per kg", high: 33.50, low: 31.80, volume: 182000, region: "west" },
        { id: 6, name: "Potatoes", icon: "fas fa-potato", price: 12.90, change: 0, unit: "per kg", high: 13.25, low: 12.60, volume: 156000, region: "north" },
        { id: 7, name: "Cotton", icon: "fas fa-tshirt", price: 95.60, change: 0, unit: "per pound", high: 96.80, low: 94.20, volume: 87000, region: "south" },
        { id: 8, name: "Sugar", icon: "fas fa-cube", price: 19.75, change: 0, unit: "per pound", high: 20.25, low: 19.40, volume: 142000, region: "east" }
    ];

    let marketChart;

    document.addEventListener('DOMContentLoaded', function() {
        renderMarketCards(cropData);
        initMarketChart(cropData);

        // Update every second
        setInterval(() => {
            updateMarketData();
            renderMarketCards(cropData);
            updateChart();
        }, 1000);

        // Filters
        document.getElementById('searchInput').addEventListener('input', filterMarket);
        document.getElementById('regionFilter').addEventListener('change', filterMarket);
        document.getElementById('sortBy').addEventListener('change', filterMarket);

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', function() {
            alert('Logout successful!');
        });
    });

    // Render cards
    function renderMarketCards(data) {
        const marketGrid = document.getElementById('marketGrid');
        marketGrid.innerHTML = '';

        data.forEach(crop => {
            const changeStatus = crop.change >= 0 ? 'up' : 'down';
            const changeIcon = crop.change >= 0 ? 'fa-arrow-up' : 'fa-arrow-down';

            const card = document.createElement('div');
            card.className = 'market-card';
            card.innerHTML = `
                <div class="card-header">
                    <div>
                        <h3>${crop.name}</h3>
                        <span>${crop.region.toUpperCase()} Region</span>
                    </div>
                    <i class="${crop.icon} crop-icon"></i>
                </div>
                <div class="card-body">
                    <div class="price-info">
                        <div class="current-price">$${crop.price.toFixed(2)}</div>
                        <div class="price-change ${changeStatus}">
                            <i class="fas ${changeIcon}"></i> ${Math.abs(crop.change).toFixed(2)}%
                        </div>
                        <div class="unit">${crop.unit}</div>
                    </div>
                    <div class="market-stats">
                        <div class="stat"><div class="stat-value">$${crop.high.toFixed(2)}</div><div class="stat-label">24H High</div></div>
                        <div class="stat"><div class="stat-value">$${crop.low.toFixed(2)}</div><div class="stat-label">24H Low</div></div>
                        <div class="stat"><div class="stat-value">${(crop.volume/1000).toFixed(1)}K</div><div class="stat-label">Volume</div></div>
                        <div class="stat"><div class="stat-value">${crop.region.toUpperCase()}</div><div class="stat-label">Region</div></div>
                    </div>
                </div>
            `;
            marketGrid.appendChild(card);
        });
    }

    // Init chart
    function initMarketChart(data) {
        const ctx = document.getElementById('marketChart').getContext('2d');
        marketChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.map(d => d.name),
                datasets: [{
                    label: 'Price ($)',
                    data: data.map(d => d.price),
                    borderColor: 'rgba(76, 175, 80, 1)',
                    backgroundColor: 'rgba(76, 175, 80, 0.2)',
                    fill: true,
                    tension: 0.3
                }]
            },
            options: {
                responsive: true,
                animation: false,
                scales: {
                    y: { beginAtZero: false }
                }
            }
        });
    }

    // Update chart without recreating
    function updateChart() {
        marketChart.data.datasets[0].data = cropData.map(d => d.price);
        marketChart.update();
    }

    // Update prices
    function updateMarketData() {
        cropData.forEach(crop => {
            const changePercent = (Math.random() * 2 - 1) / 100; // -1% to +1%
            const change = crop.price * changePercent;

            crop.price += change;
            crop.change = changePercent * 100;

            if (crop.price > crop.high) crop.high = crop.price;
            if (crop.price < crop.low) crop.low = crop.price;

            crop.volume += Math.floor(Math.random() * 500);
        });
    }

    // Filters
    function filterMarket() {
        const searchText = document.getElementById('searchInput').value.toLowerCase();
        const regionFilter = document.getElementById('regionFilter').value;
        const sortBy = document.getElementById('sortBy').value;

        let filteredData = cropData.filter(crop => 
            crop.name.toLowerCase().includes(searchText) &&
            (regionFilter === 'all' || crop.region === regionFilter)
        );

        if (sortBy === 'name') filteredData.sort((a, b) => a.name.localeCompare(b.name));
        if (sortBy === 'price') filteredData.sort((a, b) => b.price - a.price);
        if (sortBy === 'change') filteredData.sort((a, b) => b.change - a.change);

        renderMarketCards(filteredData);
        marketChart.data.labels = filteredData.map(d => d.name);
        marketChart.data.datasets[0].data = filteredData.map(d => d.price);
        marketChart.update();
    }
</script>

</body>
</html>